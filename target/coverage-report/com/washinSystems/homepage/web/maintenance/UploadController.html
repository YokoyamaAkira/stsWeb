<!DOCTYPE html>
<html>
<head>
  <title>UploadController.java</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../../../../../coverage.css'/>
  <link rel='shortcut icon' type='image/png' href='../../../../../logo.png'/>
  <script type='text/javascript' src='../../../../../coverage.js'></script>
  <script type='text/javascript' src='../../../../../prettify.js'></script>
</head>
<body onload='prettyPrint()'>
  <table cellpadding='0' cellspacing='1'>
    <caption>washinHomePage\src\main\java\com\washinSystems\homepage\web\maintenance\UploadController.java</caption>
    <tr>
      <td class='line'>1</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>package com.washinSystems.homepage.web.maintenance;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td><pre class='imports prettyprint' onclick='showHideLines(this)'><div>import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import com.washinSystems.homepage.service.NoticeEventService;
import com.washinSystems.homepage.web.LoginUserDetails;
import com.washinSystems.homepage.web.maintenance.common.StringConstant;
import com.washinSystems.homepage.web.maintenance.formData.UploadForm;
</div><span>import ...</span></pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>23</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>@Controller</pre></td>
    </tr>
    <tr>
      <td class='line'>24</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>@RequestMapping("maintenance/newsOperation")</pre></td>
    </tr>
    <tr>
      <td class='line'>25</td><td class='count'>1</td>
      <td><pre class='prettyprint covered' id='l25s0'>public class UploadController {</pre></td>
    </tr>
    <tr>
      <td class='line'>26</td><td>&nbsp;</td>
      <td><pre class='comment'>//	@Autowired</pre></td>
    </tr>
    <tr>
      <td class='line'>27</td><td>&nbsp;</td>
      <td><pre class='comment'>//	NoticeEventService noticeEventService;</pre></td>
    </tr>
    <tr>
      <td class='line'>28</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>29</td><td>&nbsp;</td>
      <td><pre class='comment'>//	@ModelAttribute</pre></td>
    </tr>
    <tr>
      <td class='line'>30</td><td>&nbsp;</td>
      <td><pre class='comment'>//	UploadForm setUpForm() {</pre></td>
    </tr>
    <tr>
      <td class='line'>31</td><td>&nbsp;</td>
      <td><pre class='comment'>//		return new UploadForm();</pre></td>
    </tr>
    <tr>
      <td class='line'>32</td><td>&nbsp;</td>
      <td><pre class='comment'>//	}</pre></td>
    </tr>
    <tr>
      <td class='line'>33</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>34</td><td>&nbsp;</td>
      <td><pre class='comment'>//	// upload file to server</pre></td>
    </tr>
    <tr>
      <td class='line'>35</td><td>&nbsp;</td>
      <td><pre class='comment'>//	@PostMapping(path = "uploadNewsPage", params = "upload_file")</pre></td>
    </tr>
    <tr>
      <td class='line'>36</td><td>&nbsp;</td>
      <td><pre class='comment'>//	String uploadNewsPage(@Validated UploadForm uploadForm, BindingResult result, Model model,</pre></td>
    </tr>
    <tr>
      <td class='line'>37</td><td>&nbsp;</td>
      <td><pre class='comment'>//			@AuthenticationPrincipal LoginUserDetails userDetails) {</pre></td>
    </tr>
    <tr>
      <td class='line'>38</td><td>&nbsp;</td>
      <td><pre class='comment'>//		if (result.hasErrors()) {</pre></td>
    </tr>
    <tr>
      <td class='line'>39</td><td>&nbsp;</td>
      <td><pre class='comment'>//	        return "sample/upload";</pre></td>
    </tr>
    <tr>
      <td class='line'>40</td><td>&nbsp;</td>
      <td><pre class='comment'>//	    }</pre></td>
    </tr>
    <tr>
      <td class='line'>41</td><td>&nbsp;</td>
      <td><pre class='comment'>//		// „Éï„Ç°„Ç§„É´„Çí‰∏?ÊôÇ„?õ„É´„É?„Å´‰øùÂ≠ò„Åô„Ç?</pre></td>
    </tr>
    <tr>
      <td class='line'>42</td><td>&nbsp;</td>
      <td><pre class='comment'>//		// „Éï„Ç°„Ç§„É´Á®ÆÈ°û„Åã„ÇâÊ±∫„Åæ„ÇãÂ?§„Çí„Çª„É?„Éà„Åô„Ç?</pre></td>
    </tr>
    <tr>
      <td class='line'>43</td><td>&nbsp;</td>
      <td><pre class='comment'>//        StringBuffer filePath = new StringBuffer("./uploadfile")//„Åì„?ÆÂÆöÊï∞„ÅØ„Éë„É©„É°„ÇøÊå?ÂÆö„Åó„Å¶„Åù„Åì„Åã„ÇâÊåÅ„Å£„Å¶„Åè„Çã</pre></td>
    </tr>
    <tr>
      <td class='line'>44</td><td>&nbsp;</td>
      <td><pre class='comment'>//                                        .append(File.separator).append("tmp");   //„Éï„Ç°„Ç§„É´„Éë„Çπ</pre></td>
    </tr>
    <tr>
      <td class='line'>45</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>46</td><td>&nbsp;</td>
      <td><pre class='comment'>//        // „Ç¢„É?„Éó„É≠„Éº„Éâ„Éï„Ç°„Ç§„É´„ÇíÊ?ºÁ¥ç„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊ?ê„Åô„Ç?</pre></td>
    </tr>
    <tr>
      <td class='line'>47</td><td>&nbsp;</td>
      <td><pre class='comment'>//        File uploadDir = mkdirs(filePath);</pre></td>
    </tr>
    <tr>
      <td class='line'>48</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>49</td><td>&nbsp;</td>
      <td><pre class='comment'>//        try {</pre></td>
    </tr>
    <tr>
      <td class='line'>50</td><td>&nbsp;</td>
      <td><pre class='comment'>//            // „Ç¢„É?„Éó„É≠„Éº„Éâ„Éï„Ç°„Ç§„É´„ÇíÁΩÆ„Å?</pre></td>
    </tr>
    <tr>
      <td class='line'>51</td><td>&nbsp;</td>
      <td><pre class='comment'>//        	String fileName = new File(uploadForm.getMultipartFile().getOriginalFilename()).getName();</pre></td>
    </tr>
    <tr>
      <td class='line'>52</td><td>&nbsp;</td>
      <td><pre class='comment'>//            File uploadFile =</pre></td>
    </tr>
    <tr>
      <td class='line'>53</td><td>&nbsp;</td>
      <td><pre class='comment'>//                    new File(uploadDir.getPath() + File.separator + fileName);</pre></td>
    </tr>
    <tr>
      <td class='line'>54</td><td>&nbsp;</td>
      <td><pre class='comment'>//            byte[] bytes = uploadForm.getMultipartFile().getBytes();</pre></td>
    </tr>
    <tr>
      <td class='line'>55</td><td>&nbsp;</td>
      <td><pre class='comment'>//            BufferedOutputStream uploadFileStream =</pre></td>
    </tr>
    <tr>
      <td class='line'>56</td><td>&nbsp;</td>
      <td><pre class='comment'>//                    new BufferedOutputStream(new FileOutputStream(uploadFile));</pre></td>
    </tr>
    <tr>
      <td class='line'>57</td><td>&nbsp;</td>
      <td><pre class='comment'>//            uploadFileStream.write(bytes);</pre></td>
    </tr>
    <tr>
      <td class='line'>58</td><td>&nbsp;</td>
      <td><pre class='comment'>//            uploadFileStream.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>59</td><td>&nbsp;</td>
      <td><pre class='comment'>//        } catch (Exception e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>60</td><td>&nbsp;</td>
      <td><pre class='comment'>//            // Áï∞Â∏∏ÁµÇ‰∫?ÊôÇ„?ÆÂá¶Áê?</pre></td>
    </tr>
    <tr>
      <td class='line'>61</td><td>&nbsp;</td>
      <td><pre class='comment'>//        } catch (Throwable t) {</pre></td>
    </tr>
    <tr>
      <td class='line'>62</td><td>&nbsp;</td>
      <td><pre class='comment'>//            // Áï∞Â∏∏ÁµÇ‰∫?ÊôÇ„?ÆÂá¶Áê?</pre></td>
    </tr>
    <tr>
      <td class='line'>63</td><td>&nbsp;</td>
      <td><pre class='comment'>//        }</pre></td>
    </tr>
    <tr>
      <td class='line'>64</td><td>&nbsp;</td>
      <td><pre class='comment'>//        </pre></td>
    </tr>
    <tr>
      <td class='line'>65</td><td>&nbsp;</td>
      <td><pre class='comment'>//		return StringConstant.Redirect_Path_newsOperation;</pre></td>
    </tr>
    <tr>
      <td class='line'>66</td><td>&nbsp;</td>
      <td><pre class='comment'>//	}</pre></td>
    </tr>
    <tr>
      <td class='line'>67</td><td>&nbsp;</td>
      <td><pre class='comment'>//	</pre></td>
    </tr>
    <tr>
      <td class='line'>68</td><td>&nbsp;</td>
      <td><pre class='comment'>//    /**</pre></td>
    </tr>
    <tr>
      <td class='line'>69</td><td>&nbsp;</td>
      <td><pre class='comment'>//     * „Ç¢„É?„Éó„É≠„Éº„Éâ„Éï„Ç°„Ç§„É´„ÇíÊ?ºÁ¥ç„Åô„Çã„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊ?ê„Åô„Ç?</pre></td>
    </tr>
    <tr>
      <td class='line'>70</td><td>&nbsp;</td>
      <td><pre class='comment'>//     *</pre></td>
    </tr>
    <tr>
      <td class='line'>71</td><td>&nbsp;</td>
      <td><pre class='comment'>//     * @param filePath</pre></td>
    </tr>
    <tr>
      <td class='line'>72</td><td>&nbsp;</td>
      <td><pre class='comment'>//     * @return</pre></td>
    </tr>
    <tr>
      <td class='line'>73</td><td>&nbsp;</td>
      <td><pre class='comment'>//     */</pre></td>
    </tr>
    <tr>
      <td class='line'>74</td><td>&nbsp;</td>
      <td><pre class='comment'>//    private File mkdirs(StringBuffer filePath){</pre></td>
    </tr>
    <tr>
      <td class='line'>75</td><td>&nbsp;</td>
      <td><pre class='comment'>//        Date now = new Date();</pre></td>
    </tr>
    <tr>
      <td class='line'>76</td><td>&nbsp;</td>
      <td><pre class='comment'>//        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMddHHmmssSSS");</pre></td>
    </tr>
    <tr>
      <td class='line'>77</td><td>&nbsp;</td>
      <td><pre class='comment'>//        File uploadDir = new File(filePath.toString(), sdf.format(now));</pre></td>
    </tr>
    <tr>
      <td class='line'>78</td><td>&nbsp;</td>
      <td><pre class='comment'>//        // Êó¢„Å´Â≠òÂú®„Åô„ÇãÂ†¥Âêà„?Ø„Éó„É¨„Éï„Ç£„É?„ÇØ„Çπ„Çí„Å§„Åë„Çã</pre></td>
    </tr>
    <tr>
      <td class='line'>79</td><td>&nbsp;</td>
      <td><pre class='comment'>//        int prefix = 0;</pre></td>
    </tr>
    <tr>
      <td class='line'>80</td><td>&nbsp;</td>
      <td><pre class='comment'>//        while(uploadDir.exists()){</pre></td>
    </tr>
    <tr>
      <td class='line'>81</td><td>&nbsp;</td>
      <td><pre class='comment'>//            prefix++;</pre></td>
    </tr>
    <tr>
      <td class='line'>82</td><td>&nbsp;</td>
      <td><pre class='comment'>//            uploadDir =</pre></td>
    </tr>
    <tr>
      <td class='line'>83</td><td>&nbsp;</td>
      <td><pre class='comment'>//                    new File(filePath.toString() + sdf.format(now) + "-" + String.valueOf(prefix));</pre></td>
    </tr>
    <tr>
      <td class='line'>84</td><td>&nbsp;</td>
      <td><pre class='comment'>//        }</pre></td>
    </tr>
    <tr>
      <td class='line'>85</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>86</td><td>&nbsp;</td>
      <td><pre class='comment'>//        // „Éï„Ç©„É´„É?‰ΩúÊ??</pre></td>
    </tr>
    <tr>
      <td class='line'>87</td><td>&nbsp;</td>
      <td><pre class='comment'>//        uploadDir.mkdirs();</pre></td>
    </tr>
    <tr>
      <td class='line'>88</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>89</td><td>&nbsp;</td>
      <td><pre class='comment'>//        return uploadDir;</pre></td>
    </tr>
    <tr>
      <td class='line'>90</td><td>&nbsp;</td>
      <td><pre class='comment'>//    }</pre></td>
    </tr>
    <tr>
      <td class='line'>91</td><td>&nbsp;</td>
      <td><pre class='comment'>//</pre></td>
    </tr>
    <tr>
      <td class='line'>92</td><td>&nbsp;</td>
      <td><pre class='comment'>//	// from workPage to listPage</pre></td>
    </tr>
    <tr>
      <td class='line'>93</td><td>&nbsp;</td>
      <td><pre class='comment'>//	@PostMapping(path = "uploadNewsPage", params = StringConstant.Params_goToBack)</pre></td>
    </tr>
    <tr>
      <td class='line'>94</td><td>&nbsp;</td>
      <td><pre class='comment'>//	String goToTop() {</pre></td>
    </tr>
    <tr>
      <td class='line'>95</td><td>&nbsp;</td>
      <td><pre class='comment'>//		return StringConstant.Redirect_Path_newsOperation;</pre></td>
    </tr>
    <tr>
      <td class='line'>96</td><td>&nbsp;</td>
      <td><pre class='comment'>//	}</pre></td>
    </tr>
    <tr>
      <td class='line'>97</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>}</pre></td>
    </tr>
  </table>
</body>
</html>
